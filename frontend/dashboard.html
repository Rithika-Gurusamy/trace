<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Academia</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body style="display: block;">
    <div class="dashboard-container">
        <header class="header animate-fade">
            <div class="user-profile">
                <div class="avatar" id="avatarTxt">U</div>
                <div>
                    <h2 id="welcomeTxt">Welcome!</h2>
                    <p style="color: var(--text-dim); font-size: 0.9rem;">Student Access</p>
                </div>
            </div>
            <button class="btn btn-outline" style="width: auto; margin: 0;" onclick="logout()">Logout</button>
        </header>

        <section class="search-card animate-fade">
            <h1 class="title">My Student Profile</h1>
            <p class="subtitle">Enter your Register Number to view or update your profile</p>

            <div style="max-width: 400px; margin: 0 auto;">
                <div class="form-group">
                    <input type="text" id="regNoInput" placeholder="Enter Register Number (e.g. 7140231...)"
                        style="text-align: center;">
                </div>
                <button class="btn btn-primary" onclick="checkProfile()">View My Details</button>
            </div>
        </section>

        <!-- No Profile Modal/State -->
        <div id="noProfileMsg" class="hidden text-center animate-fade" style="margin-top: 2rem;">
            <div class="glass-card" style="max-width: 100%;">
                <p>No profile data found for this register number.</p>
                <button class="btn btn-primary" style="margin-top: 1rem;" onclick="redirectToProfile('create')">Create /
                    Store My Details</button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('welcomeTxt').innerText = `Welcome, ${localStorage.getItem('username') || 'Student'}!`;
        document.getElementById('avatarTxt').innerText = (localStorage.getItem('username') || 'U')[0].toUpperCase();

        async function checkProfile() {
            const regNo = document.getElementById('regNoInput').value;
            if (!regNo) {
                alert("Please enter a register number");
                return;
            }

            localStorage.setItem('tempRegNo', regNo);

            try {
                const response = await fetch(`http://127.0.0.1:8000/student/profile/${regNo}`);
                if (response.ok) {
                    // Profile exists
                    window.location.href = `profile.html?reg=${regNo}`;
                } else if (response.status === 404) {
                    // Profile doesn't exist
                    document.getElementById('noProfileMsg').classList.remove('hidden');
                } else {
                    alert("Error checking profile");
                }
            } catch (err) {
                alert("Server error connecting to backend");
            }
        }

        function redirectToProfile(mode) {
            const regNo = localStorage.getItem('tempRegNo');
            window.location.href = `profile.html?reg=${regNo}&mode=${mode}`;
        }

        function logout() {
            localStorage.clear();
            window.location.href = "index.html";
        }
    </script>
</body>

</html>